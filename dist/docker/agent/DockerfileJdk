FROM registry.cmcc.com/neunn:8-jre-alpine
ENV SW_AGENT_HOME=/usr/local/agent \
    DIST_NAME=apache-skywalking-apm-incubating
ENV JAVA_OPTS="$JAVA_OPTS -javaagent:$SW_AGENT_HOME/skywalking-agent.jar"

COPY "$DIST_NAME.tar.gz" /
RUN set -ex; \
    tar -xzf "/$DIST_NAME.tar.gz"; \
    mkdir -p "$SW_AGENT_HOME" ; cp -r /$DIST_NAME/agent/* $SW_AGENT_HOME; \
    rm -rf "/$DIST_NAME.tar.gz"; rm -rf "/$DIST_NAME";
#    useradd app-user; chown -R app-user:app-user $CATALINA_HOME $SW_AGENT_HOME; su app-user